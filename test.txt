$connectAs = function() {

	fwrite(STDOUT, 'Connect as : ');
	
	return trim(fgets(STDIN));
};


fwrite(STDOUT, 'Join room : ');

$room = trim(fgets(STDIN));

$username = $connectAs();

fwrite(STDOUT, "\n Connected to '{$room}' as '{$username}' \n");

$pid = pcntl_fork();


if ($pid == -1) {

	exit(1);

} else if ($pid) {

	pcntl_wait($status);

} else {


	$pubnub->subscribe($room , function($payload) {
	    
	    var_dump($payload);

		$timestapms = date('d H-i-s');

		fwrite(STDOUT, "['{$timestapms}'] {$payload['message']['username']} > {$payload['message']['body']} \n");

	    return true;         
	});
}